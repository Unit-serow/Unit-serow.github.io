---
title: LSP-1
date: 2020-03-06 15:41:05
tags: [GNU/Linux,UNIX,OS,随笔]
categories: [软件,OS]
---

<center><strong>UNIX/Linux内核与操作系统基本概念归纳</strong></center>
<center><strong>UNIX/Linux-1</strong></center>

<!-- more -->

## LSP-1

* LSP/Linux System Prorgramming 

---

### UNIX/Linux-1

* 内核与操作系统的相关基本概念归纳

---

**章节涉及概念一览(简化版本):**
* UNIX/Linux kernel
* Shell
* 操作系统
* 数据结构
* 文件系统
* I/O模型
* 程序 (C/S)
* 内存
* 终端
* 库文件
* 进程/线程
* `/proc`文件系统

---

**内核**

* 内核概念
> 操作系统的核心
> 内核在狭义范围内被理解为用于管理与分配计算机硬件资源(即CPU，RAM，设备等)的核心层软件
> 在没有内核的情况下，计算机也能运行程序
> 内核的作用是对其它程序的编写和使用进行简化(通常会产生极大的简化效果)
> 者一切都要归功于内核为管理计算机的有限资源所提供的软件层

* 内核文件命名机制
> `vmunix/`
> `boot/vmlinuz`
> 内核为经由压缩的可执行文件

**内核的存在意义与职责**

* 进程调度
> 通常计算机内存在着若干个CPU(中央处理单元)以执行程序命令
> UNIX kernel system与UNIX-like(Linux) kernel system属于抢占式多任务系统
> 多任务意指多个进程(即运行中的程序)可同时驻留于内存，且每个进程都能够获得对CPU的使用权
> 抢占用于泛指一组规则，这组规则控制着指定进程对CPU的使用权与使用时间
> 以上两者均有内核进程调度程序(而非程序本身)决定

* 内存管理
> 由于硬件资源的有限且软件对其硬件资源的占用，使得物理内存(RAM)被定义为有限资源
> 内核的作用就是以公平且高效的方式在进程间共享这一资源
> 多数的现代操作系统(包括Linux)采用了虚拟内存管理机制
> 使得进程与进程之间，进程与内核之间彼此隔离，以防止进程读取或修改内核或其它进程中的内存内容
> 只需将进程的一部分保存在内存中，以降低每个进程对内存的需求量与实现在RAM中同时加载更多的进程
> 此方法大幅提升了在任意时刻的CPU都有至少一个进程可以执行，以使得对CPU资源的利用更加充分的情况

* 文件系统提供
> 内核在磁盘之上有提供文件系统，并且允许对文件系统执行创建，获取，更新以及删除等管理操作

* 创建和终止进程
> 内核可以将新程序载入内存，以为其提供运行所需的资源(比如CPU，内存以及对文件的访问等)
> 这样一个处于运行状态下的程序被称之为进程
> 一旦进程执行完毕，内核还要确保释放其占用的资源，以备后续程序重新使用

* 对设备与其硬件的访问
> 计算机的外界设备(人体学输入设备，磁盘或磁带驱动器等)可实现计算机与外部世界的通信
> 此通信机制包括输入，输出或两者兼而有之
> 内核即为程序访问设备提供了简化版的标准接口，同时还要仲裁多个进程对每一个设备的访问

* 联网的机制与其实现
> 内核以用户进程的名义收发网络消息(数据包)
> 该任务包括将网络数据表路由至目标系统

* 提供系统调用应用编程接口(API)
> 进程可利用内核入口点(也可称其为系统调用)请求内核去执行各种任务
> 衍生概念: Linux系统内核调用API的方法与步骤，此概念将会在以后章节内进行详细刨析与实践

* 通常情况下，多用户操作系统(例如Linux等)会为用户提供一种名为: 虚拟私有计算机(virtual private computer)的抽象概念
* 即为每个用户都可以登陆操作系统，并且其独立的操作与其它的用户大致无干(包括独立访问设备，独立运行程序，CPU，磁盘及其硬件资源独立分配等等)
* 此时的内核用于负责解决(多进程)访问硬件资源时可能引发的冲突，并且不对用户和进程产生任何层面的影响

---

**内核态与用户态**

> 现代处理器架构一般允许CPI至少在两者不同的状态下允许
> 即为用户态与核心态(有时也可称之为监管态supervisor mode)
> 执行硬件执行可使得CPU在两者状态间来回切换
> 与之相对应的虚拟内存区域也可划分(标记)为用户空间部分与内核空间部分
> 在用户状态下运行时: CPU只能访问被标记为用户空间的内存，视图访问属于内核空间的内存会引发硬件异常
> 在内核状态下运行时: CPU既能访问用户空间内存，也能访问内核空间内存
> 内核状态下运行的处理器通常可以完成某些特定操作: 此特定操作包括了执行宕机(halt)，访问内存管理硬件，以及设备I/O操作的初始化等等
> 实现者们通常会利用这一硬件设计将操作系统置于内核空间以确保用户进程不能访问内核指令和数据结构，保证了其无法对操作系统执行不利于操作系统运行的操作
> 而程序员在进行日常的编程任务时有必要去习惯于利用面向进程(process-oriented)的思维方式来考虑编程问题
> 即以进程及内核的视角来检视系统

---

### Shell相关

* shell是用于读取用户输入指令并将其相对应的程序进行执行并相应的软件程序
> 也可将其称之为命令解释器
> 术语: 登陆shell(login shell)用于特质用户刚登陆系统时，由系统创建，用以运行shell的进程
> 在某些操作系统内会将命令解释器集成于内核中，对于UNIX系统而言，shell只是一个用户进程
> 在UNIX系统的历史中出现过的重要shell: Bourne shell (sh)，C shell (csh)，Korn shell (ksh，bash)等等
> 分别对应了UNIX，BSD，Linux等等

---

### 操作系统层面相关概念列表

* 用户和组-操作系统层面概念
* 单根目录层级-操作系统层面概念
* 目录-操作系统层面概念
* 链接/路径和链接/符号链接-操作系统层面概念
* 文件/链接文件/文件类型/文件命名/文件的所有权与权限(相对于用户与操作系统)-操作系统层面概念
* 路径/路径命名-操作系统层面概念
* 当前工作目录-操作系统层面概念
* 文件[I/O模型]/文件描述符-操作系统层面概念
* stdio函数库(C语言在执行文件I/O操作时，通常会调用C标准库内的I/O函数，也可将I/O函数称为stdio函数库)，stdio函数位于I/O系统调用层之上-操作系统层面概念

---

**程序-操作系统层面概念**

* 程序的存在形式与概念:
> 程序在现实中的实现可分为两种形式: 源码文件与二进制文件
> 源码文件在执行程序时需要先将其转换(编译和链接处理)为二进制文件，即机器可以理解的二进制机器语言指令
* 脚本
> 脚本是包含命令的文本文件，它可以由shell或其它命令解释器之类的程序直接处理

* 有关程序的相关概念列表:
> 过滤器
> 命令行参数

---

**进程**

* 进程的概念与存在意义:
> 进程即为正在执行的程序实例
> 在程序执行时，内核会将程序的源码载入虚拟内存，以为程序变量分配空间，建立内核记账(bookkeeping)数据结构
> 由此记录进程有关的各种信息(如: 进程ID，用户ID，组ID及其终止状态等)

* 在内核的角度去观察进程
> 进程是一个个实体，内核必须在它们之间共享各种计算机资源
> 以实现让所有的可再生资源在进程间进行平等的资源共享

* 进程相关概念列表
> 进程的内存布局
* 逻辑上可以将某一个内存划分为这几部分(也可称为几段):
> 文本: 程序的指令
> 数据: 程序使用的静态变量
> 堆: 程序可以从该区域动态分配额外内存
> 栈: 随机函数调用，返回而增减的一片内存，用于为局部变量和函数调用链接信息分配存储空间

* 进程相关的基础概念列表:
* 创建进程
* 创建可执行程序
* 进程ID
* 父进程ID
* 进程终止与终止状态
* 进程的用户和组标识符
* 特权进程
* 能力(概念-Capabilities/始于Linux kernel-v2.2)
* init进程
* 守护进程
* 环境列表
* 资源限制

---

**内存映射**

* 内存映射基本概念及其实现方法:
> 调用系统函数`mmap()`的进程，会在其虚拟地址空间中创建一个新的内存映射
* 内存映射可分为以下两类:
1. 文件映射: 将文件的部分区域映射入调用进程的虚拟内存
> 调用一旦完成，对文件映射内容的访问则转化为对应相应内存区域的字节操作，映射页面对按需自动从文件中加载
2. 相映成趣的是并无文件与之相应的匿名映射，其映射页面的内容会被初始化为0
* 由某一进程所映射的内存可以与其它进程的映射共享，而共享的方式通常有两个:
1. 两个进程都针对某一文件的相同部分加以映射
2. 由`fork()`创建的子进程自父进程处继承映射

* 内存映射有关概念:
> 内存内容填充量分配
> 文件(I/O)，即映射内存I/O
> 进程间通信(通过内存共享映射)

---

**静态库和共享库**

* 所特指目标库的概念:
> 所谓的目标库文件就是: 将(通常是逻辑相关的)一组函数代码加以编译，并置于一个文件中，以供其它程序调用的文件
> 此方法通常有利于程序的开发与维护
* 现代UNIX系统提供两种类型的对象库: 静态库和共享库

* 静态库
> 有时也可称之为档案文件[archives]，是早期UNIX系统中唯一的一种目标库
> 从本质上来讲，可以将静态库描述为: 是对已编译目标模块的一种结构化整合
> 使用静态库时需要在创建程序的链接命令中指定相应的库
> 主程序会在之后对静态库中隶属于各目标模块的不同函数加以引用
> 对于细节这里先不做过多描述，此后的章节内会对其进行具体且完整的刨析与使用和实践

* 共享库
> 共享库存在的意义亦在解决静态库所存在的问题
> 如果将程序链接到共享库，那么此时的链接器就不会把库中的目标模块复制到执行行文件中，而是在可执行文件中写入一条记录，用以表名可执行文件在运行时需要使用该共享库
> 在运行时将可执行文件载入内存的同时会由一个名为动态链接器的程序进行同步执行，以确保将可执行文件所需的动态库找到，并载入内存
> 随后实施运行时链接，解析可执行文件中的函数调用，将其与共享库中的函数定义相关联起来
> 在运行时的共享库代码在内存中秩序保存一份，且可供所有运行中的程序使用
> 且经过编译处理的函数仅在共享库内保存一份以解决磁盘空间
> 此设计还能确保各类程序在编译时会及时使用到函数的最新版本，即只需将带有函数新定义的共享库重新加以编译即可，程序将会在下次执行时自动使用新函数

---

**进程间通信及其同步**

* Linux系统上运行有多个进程，其中许多都是独立运行
> 然而有些进程必须相互合作以达成预期目的，因此彼此间需要通信和同步机制
* 读写磁盘文件中的信息是进程通信的方法之一
> 可是这种方法对于许多程序来说既慢又缺乏灵活性
> 因此，Linux像所有现代UNIX系统所实现的那样去提供了丰富进程间通信的IPC机制

* IPC机制相关概念列表/相关作用及其存在意义:
> 信号(signal)，用于表示实践的发生
> 管道(即shell用户中的"|")操作符和FIFO，用于在进程间传递数据
> 套接字，用于为同一台主机或是联网的不同主机上所允许的进程之间传递数据
> 文件锁定，用于防止其它进程读取或更新文件内容，同时运行某进程对文件的部分区域加以锁定
> 消息队列，用于在进程之间交换消息(数据包)
> 信号量(semaphore)，用于同步进程动作
> 共享内存，用于运行两个及两个以上的进程共享同一块内存

* 就本质而言，FIFO和UNIX套接字的功能几近相同，即允许统一系统上并无关联的进程间彼此交换数据
* 两种可以并存于现在UNIX系统之中是由于FIFO来自System V，而套接字则源于BSD

* IPC相关概念:
> 对于信号及对其的深入刨析与讨论(依旧在后续章节对其实现与刨析)

---

**线程**

* 线程的基本概念描述:
> 在现代UNIX实现中，每个进程都可执行多个线程
> 可将线程的概念比喻为共享同一虚拟内存及一干其它属性的进程
> 每个线程都会执行相同的程序代码，共享同一数据区域和堆
> 并且在同时，每个线程都拥有属于自己的栈，用以装载本地变量和函数调用等链接信息
> 线程之间可通过共享的全局变量进行通信
> 此外，利用上面所描述的IPC和同步机制，线程之间也能够彼此通信

* 线程的优点:
> 线程的优点就在于协同线程之间的数据共享(通过全局变量)更为容易
> 而且就某些算法而论，以多线程来实现比之以多进程实现要更加自然
> 再者就是多线程应用能从多处理器硬件的并行处理中受益匪浅

* 有关线程的相关概念列表:
> 进程组
> shell任务控制机制
> 会话机制
> 控制终端机制
> 控制进程机制

---

**其它操作系统层面的相关概念:**

* 伪终端，是一对相互连接的虚拟设备，也可称之为主从设备
> 在这对设备之间，设有一条IPC信道以供数据之间进行双向传递
> 并且从设备(slave device)所提供的接口，其行为方式与终端相类似
> 最知名的伪终端要数telnet和ssh之类提供网络登陆服务的应用，以及 x window 系统所提供的终端窗口实现

* 日期和时间
> 进程涉及两种类型时间: 真实时间与进程时间(即为CPU时间，指自进程启动而来，所占有的CPU时间总量)
> 还可进一步的将CPU时间划分为系统CPU时间和用户CPU时间，前者用于指内核模式中执行代码所占用的时间，后者用于指在用户模式中执行代码所占用的时间
> time命令会显示出真实时间，系统CPU时间，以及执行管道中的多个线程而花费的用户CPU时间

* 客户端/服务器架构
> 即C/S架构
> 这里不做过多赘述

* 实时性
> 纯粹性概念，字面理解
> 关于实时性概念的实现与对其的具体定义这里不做过多赘述

* `/proc`文件系统
> 在Linux中实现并且提供了类似于其它的现代UNIX系统中的`/proc`文件系统
> 由一组目录和文件所组成，装配(mount，或称其为挂载)于`/proc`目录下
> `/proc`文件系统是一种虚拟文件系统，以文件系统目录和文件形式来提供一个指向内核数据结构的接口
> 以用于用户查看，改变和管理各种系统属性
> 关于/proc文件系统的内容这里先不做过多赘述，今后的章节内会进行刨析与实践

---

**本章节所涉及的相关概念归纳**

* 涉及概念一览(完整版本)
* UNIX/Linux kernel
* 操作系统
* shell/shell任务控制
* 文件
* I/O模型
* 程序
* 进程/进程间通信与进程间同步
* 信号
* 线程
* 进程组
* 会话
* 内存/内存映射
* 静态库
* 共享库
* 终端控制
* 进程控制
* 伪终端
* 日期及时间
* C/S-客户端/服务器架构
* 实时性
* `/proc`文件系统

**本章节涉及概念一览(简化版本):**
* UNIX/Linux kernel
* Shell
* 操作系统
* 数据结构
* 文件系统
* I/O模型
* 程序 (C/S)
* 内存
* 终端
* 库文件
* 进程/线程
* `/proc`文件系统

---

### 参考文献

* 所有涉及的文献资料皆来源于电子书籍

* [CN-Linux/UNIX 系统编程手册-上册(Michael Kerrisk)](http://unit-serow.com/2020/03/05/OS-1/#more)
> 第二章节内容
> PDF资源可参考文章OS-1

---



