---
title: LFS-2
date: 2020-02-22 16:07:09
tags: [随笔,GNU/Linux]
categories: [软件,GNU]
---

## Linux from Scratch/LFS-2

* 名词解释
* 制作逻辑
* 相关技术 LSF-3
* 制作步骤 LSF-4
* 目的为创造一个崭新的，基于Linux内核的操作系统

---

**linux from scratch**

### 涉及名称一览(解释)

**主系统**
* 源系统，用于提供制作处新系统的基本环境
* 可以比喻成一架航母上的某一架飞机的基础机型

**目标系统**
* 基于主系统要仿制/制作的目标系统(最终目的)
* 可以比喻成要仿制基础机型进行制造的另一架飞机

**临时系统**
* 在制作目标系统的过程中需要的过渡系统，用于辅助目标系统的制作过程
* 可以比喻成要制造却还在规划中的飞机模型与飞机的基本结构

---

**编译工具**
* 这里将汇编工具Binutils与编译器GCC合称为编译工具

**工具链**
* 汇编工具，编译器，与C标准库(Binutils，GCC，Glibc)合成为工具链
* 因为让工具链生成可执行文件通常都需要函数库(标准库)，所以这里这里将函数库包含于工具链内

* 因为在整个制作过程中，各个阶段都会产生工具链，所以这里将各个阶段的工具链名称进行以下定义和命名

1. 原工具链
* 主系统的工具链
2. 预工具链
* 用于生成临时工具链的工具链
3. 临时工具链
* 用于生成临时系统的工具链
4. 目标工具链
* 用于生成目标系统的工具链

---

**辅助命令**
* 在编译软件包的过程中，处理工具链以外通常还需要一些命令的参与
* 类似于make之类的，这类工具这里将其合成为辅助命令

**工具链环境**
* 将工具链同辅助命令合称为工具链环境，因为不同的阶段会出现不同的组合，所以这里将各个阶段工具链环境的名称进行以下定义和命名
1. 预工具链环境
* 预工具链+主系统中的辅助命令及基本函数库
2. 预临时工具链环境
* 临时工具链+临时系统中的辅助命令及基本函数库
3. 目标工具链
* 目标工具链+目标系统中的辅助命令及基本函数库

---

**运行环境**
* 因为在一个运行的系统中可以存在多个不同的环境，这些环境中有各自的根目录及环境设置
* 这一类的环境被称为运行环境，因为在制作过程中各个阶段会处于不同的运行环境，所以这里将各个阶段的运行环境进行以下定义和命名
1. 主系统运行环境
* 以主系统所在的运行环境
2. 目标系统运行环境
* 目标系统所在目录为根目录的运行环境

---

**头文件**
* 用于编译的一类文件，以存放函数的接口描述与结构体信息等程序设计的相关内容

**纯净度**
* 目标系统对于主系统依赖程度的评估
* 目标系统必须完全不依赖于主系统，才可称其为独立系统

---

**结构体系描述**

> `系统=内核+各类函数库+交互环境+各种应用程序(常用命令的指令集)+各类配置文件(辅助文件)`

> `[程序]-配置文件->[命令]-配置文件->[交互环境]-配置文件->[函数库]->{内核}`

---

**启动过程描述**

> `BIOS/UEFI->GRUB/LILO->KERNEL(Kernel)`

---

**基本编译过程描述**

> `[Make]-GCC/各种编译工具-[源代码]->[目标代码]`
> 同时Binutils利用以生成的目标代码
> `[Make]-[Binutils]->[共享函数库(运行时需要)/静态函数库(编译进程序)]-[目标代码]->{可执行程序}`

---

### 制作逻辑描述

* 常用命令尽量使用GNU所提供的

1. 主系统准备
* 主系统与目标系统相同或相兼容
* 拥有工具链与辅助命令，即为原工具链

---

2. 预工具链的生成
* 主系统准备好之后就可以建立预工具链了
* 建立预工具链的目的是建立临时工具链
* 预工具链由原工具链生成，即为原工具链(初始工具链)到临时工具链(目的工具链)的过渡工具链
* 预工具链建立之初是一个内部依赖方式的工具链，用它编译出来的程序文件将链接到主系统的Glibc(C标准库)上

---

3. 临时工具链的生成
* 临时工具链的目的是建立临时系统，临时系统需要脱离主系统的运行环境
* 临时工具链本身也是临时系统的重要组成部分，所以临时工具链也能够脱离主系统的运行环境
* 预工具链负责完成临时系统种的Glibc，当Glibc完成后对预工具链进行依赖方式的调整，使与工具链变为外部依赖的工具链
* 调整完成后生成临时编译工具，临时编译工具依赖于临时系统种的Glibc
* 临时编译工具与临时系统的Glibc一起组成临时工具链，预工具链的使命到此完成
* 临时工具链将代替预工具链完成临时系统的制作
* 临时工具链不依赖主系统下的函数库，临时工具链为内部依赖的形式

**逻辑简述:**
> `[主系统(源工具链/辅助命令/其它命令...)]-1->[预工具链]-2->[临时工具链]`
> 同时
> `[辅助命令]-2->[临时工具链]`

---

4. 临时系统的生成
* 编译一个软件往往除了编译器之外还需要其它程序的参与，仅仅靠临时工具链是无法完成目标系统的制作的
* 因此需要一个相对完整的工具链环境，临时系统将完成临时工具链环境的创建
* 临时工具链环境的创建过程需要主系统的辅助命令参与完成，在完成临时工具链环境的辅助命令后便完成了临时工具链
* 此时的临时工具链不再依赖主系统种的辅助命令编译软件了，为临时系统脱离主系统环境做好准备
* 临时工具链将继续完成临时系统的制作，临时系统的制作目的是为了给制作目标提供一个不依赖于主系统的编译环境
* 用临时工具链生成临时系统可保证其中各种工具环境所依赖的函数库也是临时系统种的函数库

**逻辑简述:**
> `[主系统(源工具链/辅助命令/其它命令...)]-1->[预工具链]-2->[临时系统(临时工具链)-3->(辅助命令)]`
> 同时
> `[辅助命令]-3->[临时系统(辅助命令)]`

---

5. 目标工具链
* 此时临时系统已经完成制作，接下来将要做的是让临时系统脱离主系统，即用临时系统去制作目标系统
* 同时为了能让目标系统称为自我扩展的系统，必须人为的为这个目标系统提供一个工具链
* 即用已经生成的临时系统来生成目标系统的Glibc，然后调整临时工具链使其编译出来的程序文件或库文件链接到目标系统的Glibc上
* 即内部依赖的临时工具链变成外部依赖方式，再编译目标系统上的Binuils和GCC
* 此时完成目标工具链的建立，下一步将再用目标工具链和生成目标工具链环境
* 此时临时工具链已经完成了使命，但临时工具链环境种的辅助命令还需要继续使用直到目标工具链中相应的辅助命令建立，从而形成目标工具链环境

---

6. 目标工具链环境的生成
* 为了让目标系统能够自给自足的进行扩展更新，目标系统需要带有最基本的编译环境
* 以上的操作已经将目标工具链生成，但使用的辅助命令还是临时系统中的命令
* 这个时候就需要人为的编译这些需要用到的辅助命令，并安装到目标系统中，以此成为目标工具链环境

**逻辑简述:**
> `[主系统(源工具链/辅助命令/其它命令...)]-1->[预工具链]-2->[临时系统(临时工具链)-3->(辅助命令)]`
> 同时
> `[辅助命令]-3->[临时系统(辅助命令)]`
**在以上步骤进行完成后**
> `[临时系统(临时工具链/辅助命令)]-4->[目标工具链]`

* 按照生成临时系统的内容编译完各种辅助命令之后，就可以安装更多的辅助命令或其它程序了

**在以上步骤进行完成后**
> `[临时系统(临时工具链/辅助命令)]-4->[目标工具链环境(目标工具链)-5->(辅助命令)]`
> 同时
> `[目标工具链环境(辅助命令)]<-5->[临时系统(辅助命令)]`

---

7. 目标系统的生成
* 在目标工具链环境生成之后将这个环境进一步完善，包括编辑工具，网络工具等，使之成为真正有用的目标系统
* 这部分内容的选择并没由什么限制与约束
* 在目标系统主体程序安装完毕后需要让这个系统能够正常而独立的运行起来，还需要人为的对启动过程进行处理

**逻辑表示即为**
> `[主系统]-预工具链->[临时系统]->[目标系统]`

**精准逻辑表示**

**区块一:**
> `区块一(主系统->临时系统)`
> `[主系统(源工具链/辅助命令/其它命令)]-1->预工具链-2->[临时系统(临时工具链-3->辅助命令)]`
> 同时
> `[主系统(辅助命令)]-2->[临时系统(临时工具链-3->辅助命令)]`
> 同时
> `[主系统(辅助命令)-3->[临时系统(辅助命令)]`

**区块二:**
> `区块二(临时系统->目标系统)`
> `[临时系统(临时工具链-3->辅助命令)]-4->[目标系统(目标系统工具链环境-5->辅助命令)-6->(其它命令...)]`
> 同时
> `[临时系统(辅助命令)]-4->[目标系统(命令工具链)]`
> `[临时系统(辅助命令)]<-5->[目标系统(辅助命令)]`

---

### 执行逻辑一览(汇总)

* 可以分为三个阶段，六个时间点(步骤点)

* 阶段一
1. 利用主系统的工具链与辅助命令生成预工具链
2. 利用主系统中的辅助命令与已经生成的预工具链生成临时系统中所需的临时工具链

* 阶段二
3. 利用主系统中的辅助命令和临时系统中的临时工具链生成临时系统中的辅助命令
4. 利用临时系统中的临时工具链和辅助命令生成目标系统中的目标工具链

* 阶段三
5. 利用目标系统中的目标工具链生与临时系统中的辅助命令生成目标系统中的辅助命令，以此生成目标工具链环境(目标工具链+辅助命令)
6. 利用目标系统中的目标工具链环境中的目标工具链和辅助命令生成其它命令

---
